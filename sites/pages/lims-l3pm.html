<!--# include file="/sites/docs/include/homepage-html-dev-1.html" -->
<script>
    var getRootPath = function () {
        return "http://10.10.1.234:30000/";
    }
</script>
<container>
    <style type="text/css">
        .pt-tree-title {
            font-size: 18px;
            font-weight: normal;
            display: inline-block;
        }
        .no-data{
            min-height: 80px !important;
        }
        .pt-block-list.block-standard {
            /* width:260px; */
            width: 160px;
            height: 60px;
            background: none;
            border: 1px solid rgb(191, 191, 191)
        }

        /* .pt-block-list.block-standard:hover{
            border:1px solid red,
        } */
        .block-standard-text .pt-block-content .block-standard-text.text:not {
            background: #fff;
        }

        .pt-block-list .pt-block-content span:not(.title) {
            background: #fff;
        }
        .pt-tree-form-panel{
            display: none;
        }
    </style>
    <div class="pt-main businessdatabase ">
        <div class="pt-container">
            <div class="pt-main-row">
                <div class="pt-main-col" id="tree-component-standard-0">
                    <div class="pt-panel">
                        <div class="pt-container">
                            <div class="pt-panel-row">
                                <div class="pt-panel-col">
                                    <div class="pt-tree">
                                        <div class="pt-container">
                                            <div class="businessdatabase-tree-ztree layout-ztree" style="height:700px;"
                                                id="tree-tree-component-standard-0"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="pt-main-col" style="margin-top: 20px;">
                    <div class="pt-panel nav-form" id="mainlist-btn-component-standard-2"></div>
                    <div class="pt-panel businessdatabase-grid-component" id="mainlist-component-standard-1"></div>
                    <div class="pt-panel nav-form" id="detaillist-btn-component-standard-5"></div>
                    <div class="pt-panel businessdatabase-grid-component" id="detaillist-component-standard-1"></div>
                    <div class="pt-panel businessdatabase-grid-component" id="detaillist-component-standard-2"></div>
                </div>
        </div>
    </div>
    <script type="text/javascript">
        //配置参数包含：
        /*1.要填充的容器元素 id
        2.请求的ajax链接 url
        3.请求的参数 data
        4.节点父id   pid
        5.当前节点的id valueField
        6.当前节点的名称 textField
        7.是否是异步请求 async
        8.返回的数据源参 dataSrc
        9.子元素包含的children  haschildField  childrenField
        10.是否有默认值 value
        11.单击节点的返回函数 clickCallback
        12.选中节点的返回函数 checkCallback
        13.是否支持多选  isCheck
        14.节点全称  fullnameField
        15.请求方式 get or post
        16.勾选父节点和子节点之间的关系 如勾选子节点的时候是否勾选父节点 isCheckParent       
        */
       


        var limsTemplate = {};
        $(function () {
            //nsLayout.init("demos-layout-tree");
            var templateJson = {
                package: 'nsVue.graps.Price',
                template: 'businessDataBase',
                // title:'商品分类',
                components: [{
                        type: 'tree',
                        id: 'tree-tree-component-standard-0',
                        title: '价格管理',
                        treeId: 'id',
                        idField: 'id',
                        height: 620,
                        isSearch: true,
                        ajax: {
                            // contentType:'application/json; charset=utf-8',
                            // contentType: 'application/x-www-form-urlencoded',
                            type: "POST",
                            // url : getRootPath() + '/base/data/getSampleCateTreeList.json',
                            url:getRootPath() + '/sampleCate/getSampleCateTreeList',
                            dataSrc: 'rows',
                            // data:   {id:"1"},
                            data: {},
                        },
                        addAjax: {
                            url:getRootPath() + '/dataSourceNodes/addNode',
                        },
                        editAjax: {
                            url: getRootPath() +'/dataSourceNodes/updateNode',
                            dataSrc: 'rows',
                        },
                        deleteAjax: {
                            url: getRootPath() +'/dataSourceNodes/delById',
                            dataSrc: 'rows',
                        },
                        moveAjax: {
                            url: getRootPath() + '/dataSourceNodes/moveNode',
                            dataSrc: 'rows',
                        },
                        textField: 'sampleCateName',
                        parentField: 'parentId',
                        childField: 'children',
                    },
                    {
                        type: 'blockList',
                        idField: 'id',
                        parent: 'root',
                        id: 'mainlist-component-standard-1',
                        // plusClass:'',
                        ajax: {
                            src: getRootPath() + '/sampleCateStd/getList.json', //数据源地址
                            type: "POST", //GET POST
                            contentType: 'application/json; charset=utf-8', 
                            data: {
                                sampleCateId: '-1'
                            }, //参数对象{id:1,page:100}
                            //isServerMode:         true,           //是否开启服务器模式
                            dataSrc: 'rows',
                        },
                        field: [{
                            field: 'stdName',
                            title: '产品标准名称',
                            width: 150,
                            searchable: true,
                            orderable: false,
                            isCommon: true,
                        }],
                        ui:{
                            isEditMode: false,
                            selectMode: "single",
                            selectedHandler:function(){
                                debugger;
                            }    
                        },
                        listExpression: "<div class='block-standard-text'>" +
                            "<span class='text' 'style='backgroud:'#fff''>{{stdName}}</span>" +
                            "</div>"
                    },
                    {
                        title: '产品检测项目',
                        keyField: 'GoodsPlatformVo',
                        idField: 'id',
                        id: "detaillist-component-standard-1",
                        ajax: {
                            src: getRootPath() + '/testPrices/getList',
                            type: 'POST',
                            data: {
                                sampleCateStdId: '-1',
                            },
                            dataSrc: 'rows',
                            contentType: 'application/json; charset=utf-8'
                        },
                        type: 'list',
                        ui: {

                            isEditMode: true,
                            displayMode: "treeGrid",
                            parentField: "parentId",
                            level: -1
                        },
                        field: [{
                                field: 'itemName',
                                title: '检测项目',
                                searchable: true,
                                isTreeNode: true,
                                editable: true,
                                width: 100,
                            }, {
                                field: 'testMethodId',
                                title: '检测方法',
                                width: 100,
                                searchable: true,
                                editable: false,
                                editable: true,
                            }, {
                                field: 'sampleStdChapter',
                                title: '方法编号',
                                width: 100,
                                searchable: true,
                                editable: true,
                            }, {
                                field: 'priceGroupName',
                                title: '价格组',
                                width: 100,
                                editable: true,
                            }, {
                                field: 'groupPrice',
                                title: '价格组价格',
                                width: 100,
                                editable: true,
                            }, {
                                field: 'samplingDesc',
                                title: '默认实验数量',
                                width: 100,
                                editable: true,
                            }, {
                                field: 'defaultTestQuantity',
                                title: '默认实验数量单位',
                                width: 100,
                                editable: true,
                            }, {
                                field: 'defaultUnit',
                                title: '是否维护价格',
                                width: 100,
                                editable: true,
                            }, //{
                            //     field:'stdValue',
                            //     title: '标准值',
                            //     width:80,
                            //     columnType : 'standardInput',
                            //     editable : true,
                            //     editConfig : {
                            //         type : 'standardInput',
                            //         attrTextField : 'name',
                            //         attrValueField : 'id',
                            //         ajax : {
                            //             url : getRootPath() + '/sampleItem/getStdValue',
                            //             dataSrc : 'rows',
                            //             data : {"id":"{this.id}"},
                            //             type : 'GET',
                            //             contentType : 'application/x-www-form-urlencoded'
                            //         },
                            //         subdataAjax : {
                            //             url : getRootPath() + '/base/data/getTreeList.json',
                            //             dataSrc : 'rows',
                            //             data : {"propId":"{id}"},
                            //             type : 'GET',
                            //             // contentType : 'application/json; charset=utf-8'
                            //             contentType: 'application/x-www-form-urlencoded'
                            //         },
                            //     }

                            // }
                        ]
                    },
                    {
                        title: '检测方法',
                        keyField: 'GoodsPlatformVo',
                        idField: 'id',
                        id: "detaillist-component-standard-2",
                        type: 'list',
                        ajax: {
                            src: getRootPath() + 'priceDetails/getList',
                            type: 'POST',
                            data: {
                                sampleCateStdId: '-1',
                            },
                            dataSrc: 'rows',
                            contentType: 'application/json; charset=utf-8'
                            // contentType: 'application/x-www-form-urlencoded'
                        },
                        field: [{
                            field: 'propertyValue',
                            title: '属性',
                            searchable: true,
                            width: 80,
                            editable: true,
                        }, {
                            field: 'refPrice',
                            title: '参考价格',
                            width: 80,
                            searchable: true,
                            editable: true,
                            mindjetType: "text",
                        }, {
                            field: 'unit',
                            title: '单位',
                            width: 100,
                            editable: true,
                            mindjetIndexState: 2,
                            isDefaultSubdataText: true,
                        }, {
                            field: 'gdp',
                            title: '产值',
                            width: 60,
                            editable: true,
                        }, {
                            field: 'permitDisCount',
                            title: '允许打折',
                            width: 60,
                            editable: true,

                        }, ]
                    },
                    {
                        type: 'btns',
                        position: 'text-left',
                        id: 'mainlist-btn-component-standard-2',
                        field: [
                            // {
                            //     text:'选择标准',
                            //     isReturn:true,
                            //     handler:function(){
                            //         var url = getRootPath()+'/templateMindPages/pageConfig/1307723194085409769';
                            //         dialogTemplateByUrl(url)   
                            //     }
                            // }
                        ]
                    },
                    {
                        type: 'btns',
                        position: 'text-left',
                        id: 'detaillist-btn-component-standard-5',
                        field: [{
                                text: '同步按钮',
                                isReturn: true,
                                shortcutKey: 'ALT+N',
                                handler: function () {
                                    // var url = getRootPath() +
                                    //     '/templateMindPages/pageConfig/1311226439994968050';
                                    // dialogTemplateByUrl(url)
                                    // var url = '',
                                    // var ajaxData 
                                    var  sampleCateId = NetstarTemplate.tree.getSelectedNodes('tree-tree-component-standard-0')[0].id;
                                    var stdId = NetStarGrid.dataManager.getData('mainlist-component-standard-1')[0].stdId;

                                    var ajaxData = {
                                        sampleCateId:sampleCateId,
                                        stdId:stdId,
                                    }
                                    NetStarUtils.ajax({
                                        url:getRootPath() +'/testPrices/syncSampleItem',
                                        type:"POST",
                                        //contentType: 'application/x-www-form-urlencoded',
                                        data:ajaxData,
                                    },function(res, _ajaxConfig){
                                        nsalert("同步成功",'success');
                                        console.log(res.rows);
                                        var resDate = res.rows;
                                      
                                        if($.isArray(resDate)){
                                            NetStarGrid.refreshDataById('mainlist-component-standard-1',resDate);
                                        }else{

                                        }
                                       
                                    })

                                }
                            },
                            {
                                text: '编辑项目',
                                isReturn: true,
                                shortcutKey: 'ALT+C',
                                handler: function () {
                                    var url = getRootPath() +
                                        '/templateMindPages/pageConfig/1311226439994968050';
                                    dialogTemplateByUrl(url, 'edit')
                                }
                            },
                            {
                                text: '新增项目价格',
                                isReturn: true,
                                shortcutKey: '',
                                handler: function () {
                                    var url = getRootPath() +
                                        '/templateMindPages/pageConfig/1311340926643209202';
                                    dialogTemplateByUrl(url);
                                }
                            },
                            {
                                text: '维护项目价格',
                                isReturn: true,
                                shortcutKey: '',
                                handler: function () {
                                    var url = getRootPath() +
                                        '/templateMindPages/pageConfig/1311340926643209202';
                                    dialogTemplateByUrl(url, 'edit');
                                }
                            },
                            {
                                text: '创建价格组',
                                isReturn: true,
                                shortcutKey: '',
                                handler: function () {
                                    var url = getRootPath() +
                                        '/templateMindPages/pageConfig/1311226439994970098';
                                    dialogTemplateByUrl(url, 'ids');
                                }
                            },
                            {
                                text: '加入价格组',
                                isReturn: true,
                                shortcutKey: '',
                                handler: function () {
                                    var url = getRootPath() +
                                        '/templateMindPages/pageConfig/1311226439994969074';
                                    dialogTemplateByUrl(url, 'ids');
                                }
                            },
                            {
                                text: '移除价格组',
                                isReturn: true,
                                shortcutKey: '',
                                handler: function () {
                                    var detailCheckedData = NetStarGrid.getCheckedData('detaillist-component-standard-1');
                                    var ids = '';
                                    for (var i = 0; i < detailCheckedData.length; i++) {
                                        ids += detailCheckedData[i].id + ',';
                                    }
                                    ids = ids.substring(0, ids.length - 1);
                                    var ajaxConfig = {
                                        url: getRootPath() +'/testPrices/leaveGroup',
                                        type: 'GET',
                                        data: {
                                            ids: ids
                                        },
                                        contentType:'application/x-www-form-urlencoded',
                                    }
                                    NetStarUtils.ajax(ajaxConfig, function (res, _ajaxConfig) {
                            if (res.success) {
                                nsAlert('删除成功');
                            }
                                    })
                                }
                            }

                        ]
                    }
                ],
            };

            //弹出模版页面

            limsTemplate.showTemplateByPageData = function (config, editorType, ids) {
                var treeArray = NetstarTemplate.tree.getSelectedNodes('tree-tree-component-standard-0');
                var mainSelectedData = NetstarBlockList.getSelectedData('mainlist-component-standard-1');
                var detailSelectedData = NetStarGrid.getSelectedData('detaillist-component-standard-1');
                var detailCheckedData = NetStarGrid.getCheckedData('detaillist-component-standard-1');


                if ($.isArray(mainSelectedData)) {
                    config.pageParam.sampleCateId = treeArray[0].id
                    if (mainSelectedData.length > 0) {
                        config.pageParam.sampleCateStdId = mainSelectedData[0].id;
                        config.pageParam.sampleCateId = mainSelectedData[0].sampleCateId;
                        //config.pageParam.ids = mainSelectedData[0].sampleCateId;//////
                        config.pageParam.stdId = mainSelectedData[0].stdId;
                    }
                }
                if ($.isArray(detailSelectedData)) {
                    if (detailSelectedData.length > 0) {
                        config.pageParam.parentId = detailSelectedData[0].id;
                    }
                }
                switch (editorType) {
                    case 'edit':
                        config.pageParam = detailSelectedData[0];
                        if (typeof (config.pageParam) == 'undefined') {
                            config.pageParam = {};
                        }
                        break;
                    case 'ids':
                        config.pageParam.ids = ids;
                        break;
                }
                for (var i = 0; i < config.components.length; i++) {
                    var componentData = config.components[i];
                    switch (componentData.type) {
                        case 'vo':
                            var fieldArray = componentData.field;
                            for (var fieldI = 0; fieldI < fieldArray.length; fieldI++) {
                                if (config.pageParam[fieldArray[fieldI].id]) {
                                    fieldArray[fieldI].value = config.pageParam[fieldArray[fieldI].id];
                                }
                                if (typeof (config.pageParam[fieldArray[fieldI].id]) == 'number') {
                                    fieldArray[fieldI].value = config.pageParam[fieldArray[fieldI].id];
                                }
                                /*if(fieldArray[fieldI].id == 'sampleCateId'){
                                    fieldArray[fieldI].value = config.pageParam.sampleCateId;
                                }else if(fieldArray[fieldI].id == 'stdId'){
                                    fieldArray[fieldI].value = config.pageParam.stdId;
                                }else if(fieldArray[fieldI].id == 'sampleCateStdId'){
                                    fieldArray[fieldI].value = config.pageParam.sampleCateStdId;
                                }else if(fieldArray[fieldI].id == 'parentId'){
                                    fieldArray[fieldI].value = config.pageParam.parentId;
                                }*/
                            }
                            break;
                    }
                }
                config.closeHandler = function () {
                    var treeJson = {};
                    var treeArray = NetstarTemplate.tree.getSelectedNodes(
                        'tree-tree-component-standard-0');
                    if (treeArray.length > 0) {
                        if (treeArray.length == 1) {
                            treeJson = treeArray[0];
                        }
                    }
                    NetStarGrid.refreshById('mainlist-component-standard-1', {
                        sampleCateId: treeJson.id
                    });
                }
                NetstarTemplate.init(config);
            }

            function dialogTemplateByUrl(url, editorType) {
                if (editorType == 'edit') {
                    var tempValueName = new Date().getTime();
                    NetstarTempValues[tempValueName] = {
                        id: '3333'
                    };
                    var urlStr = encodeURIComponent(encodeURIComponent(tempValueName));
                    url = url + '?templateparam=' + urlStr;
                }
                var ajaxConfig = {

                    pageIidenti: url,
                    url: url,
                    type: 'GET',
                    dataType: 'html',
                    callBackFunc: function (isSuccess, data, _ajaxConfig) {
                        if (isSuccess) {
                            if (editorType == 'ids') {
                                var detailCheckedData = NetStarGrid.getCheckedData('detaillist-component-standard-1');
                                var ids = '';
                                for (var i = 0; i < detailCheckedData.length; i++) {
                                    ids += detailCheckedData[i].id + ',';
                                }
                                ids = ids.substring(0, ids.length - 1);
                            }
                            // var indexOf=function(){}
                            var funcStr = 'limsTemplate.showTemplateByPageData(pageConfig,"' +
                                editorType + '","' + ids + '")';
                            var starStr = '<container>';
                            var containerPage = data.substring(data.indexOf(starStr) + starStr.length,
                                data.indexOf('</container>'));
                            var exp = /NetstarTemplate\.init\((.*?)\)/;
                            var funcStrRep = funcStr.replace('pageConfig', containerPage.match(exp)[1]);
                            containerPage = containerPage.replace(containerPage.match(exp)[0],
                                funcStrRep);
                            var $container = nsPublic.getAppendContainer();
                            $container.append(containerPage);
                        }

                    }
                };
                // $.ajax(ajaxConfig);
                pageProperty.getAndCachePage(ajaxConfig);
            }

            function init() {
                var mainConfig = templateJson.components[1];
                var treeConfig = templateJson.components[0];
                treeConfig.clickHandler = function (data) {
                    /*
                     *config 			容器id
                     *treeId 			节点值
                     *treeNode 			当前节点数据
                     */
                    var treeJson = {};
                    var treeArray = NetstarTemplate.tree.getSelectedNodes('tree-tree-component-standard-0');
                    if (treeArray.length > 0) {
                        if (treeArray.length == 1) {
                            treeJson = treeArray[0];
                        }
                    }
                    NetStarGrid.refreshById('mainlist-component-standard-1', {
                        sampleCateId: treeJson.id
                    });
                    NetStarGrid.refreshById('detaillist-component-standard-1', {
                        sampleCateId: treeJson.id
                    });
                }
                NetstarTemplate.tree.init(treeConfig);

                function refreshTabListDataByAjax(data, _gridId) {
                    if (typeof (data) == "undefined" || $.isEmptyObject(data)) {
                        return;
                    }
                    var ajaxConfig = {};
                    var refreshGridId = '';
                   
                    if (_gridId == 'mainlist-component-standard-1') {
                        var _data = {
                            sampleCateStdId: data.id
                        };
                        ajaxConfig = {
                            url: getRootPath() + '/base/data/getTreeList.json',
                            type: 'get',
                            data: _data,
                            dataSrc: 'rows',
                            // contentType:'application/json; charset=UTF-8'
                            contentType: 'application/x-www-form-urlencoded'
                        };
                        refreshGridId = 'detaillist-component-standard-1';
                    }
                    if (_gridId == 'detaillist-component-standard-1') {
                        //刷新第三个表格
                        var _data = {
                            sampleItemId: data.id
                        };
                        ajaxConfig = {
                            url: getRootPath() + '/base/data/getList.json',
                            type: 'get',
                            data: _data,
                            dataSrc: 'rows',
                            plusData: {
                                gridId: _gridId
                            },
                            // contentType:'application/json; charset=UTF-8'
                            contentType: 'application/x-www-form-urlencoded'
                        };
                        refreshGridId = 'detaillist-component-standard-2';
                    }

                    NetStarGrid.refreshById(refreshGridId, ajaxConfig.data);
                    /*nsVals.ajax(ajaxConfig,function(res,ajaxData){
                        if(res.success){
                            //调用ajax成功
                            var resData = res[ajaxData.dataSrc];
                            //如果返回的不是数组，可能是空数组
                            if(!$.isArray(resData)){
                                resData = [];
                            }
                            var listJson = {
                                'detaillist-component-standard-1':{
                                    keyField:'rows'
                                }
                            };
                            if(ajaxData.plusData.gridId == 'detaillist-component-standard-1'){
                                listJson = {
                                    'detaillist-component-standard-2':{
                                        keyField:'rows'
                                    }
                                };
                            }
                            for(var gridId in listJson){
                                var gridConfig = listJson[gridId];
                                NetStarGrid.resetData(resData, gridId);
                            }
                        }else{
                            for(var gridId in listJson){
                                var gridConfig = listJson[gridId];
                                NetStarGrid.resetData([], gridId);
                            }
                        }
                    },true)*/
                }

                function getGridConfig(_grid) {
                    var gridConfig = {
                        id: _grid.id,
                        type: _grid.type,
                        idField: _grid.idField,
                        isReadStore: false,
                        data: {
                            idField: _grid.idField,
                            model: '1',
                        },
                        columns: $.extend(true, [], _grid.field),
                        ui: {
                            isHaveEditDeleteBtn: false,
                            isHaveAddBtn: true,
                            isEditMode: false,
                            selectMode: 'single',
                            height: parseInt($(window).outerHeight() / 3),
                            listExpression: _grid.listExpression,
                        }
                    };
                    if (_grid.parent == 'root') {
                        // gridConfig.ui.isHaveEditDeleteBtn = false;
                        gridConfig.ui.height = 100;
                        // gridConfig.ui.width = 300;
                        gridConfig.ui.defaultSelectedIndex = 0;
                        gridConfig.plusClass = 'block-standard';
                        /* gridConfig.ui.tableRowBtns = [
                             {
                                 text:'删除',
                                 handler:function(data){
                                     console.log(data);
                                     nsConfirm('是否确认删除',function(success){
                                         if(success){
                                             var deleteAjaxConfig = {
                                                 url:getRootPath() + '/sampleCateStd/deleteById.json',
                                                 dataSrc:'data',
                                                 type:'POST',
                                                 data:{
                                                     id:data.rowData.id
                                                 },
                                                 contentType: 'application/x-www-form-urlencoded'
                                             };
                                             NetStarUtils.ajax(deleteAjaxConfig,function(res){
                                                 if(res.success){
                                                     NetStarGrid.delRow(data.rowData, data.gridId, data.rowIndex);
                                                 }
                                             },true)
                                         }
                                     })
                                 }
                             }
                         ];*/
                    }
                    if (_grid.id == 'detaillist-component-standard-1' || _grid.id ==
                        'mainlist-component-standard-1') {
                        // gridConfig.ui.isHaveEditDeleteBtn =true;
                        gridConfig.ui.drawHandler = function (_vueData) {
                            var gridId = _vueData.$options.id;
                            var rowsData = _vueData.rows;
                            var originalRows = _vueData.originalRows;
                            var grid = NetStarGrid.configs[gridId];

                            if ($.isArray(rowsData)) {
                                var selectedIndex = -1;
                                var startI = 0;
                                if (grid.gridConfig.data.isServerMode == false) {
                                    startI = _vueData.page.start;
                                }
                                for (var rowI = 0; rowI < rowsData.length; rowI++) {
                                    if (originalRows[rowI + startI]) {
                                        //存在于原始数据中
                                        if (rowsData[rowI].netstarSelectedFlag) {
                                            selectedIndex = rowI;
                                            break;
                                        }
                                    }
                                }
                                if (selectedIndex > -1) {
                                    //存在选中行的值
                                    var data = originalRows[selectedIndex + startI];
                                    refreshTabListDataByAjax(data, gridId);
                                }
                            }
                        }
                    }
                    if (_grid.id == 'detaillist-component-standard-1') {
                        /*gridConfig.ui.tableRowBtns = [
                            {
                                text:'删除',
                                handler:function(data){
                                    console.log(data);
                                    nsConfirm('是否确认删除',function(success){
                                        if(success){
                                            var deleteAjaxConfig = {
                                                url:getRootPath() + '/sampleItem/deleteById.json',
                                                dataSrc:'data',
                                                type:'POST',
                                                data:{
                                                    id:data.rowData.id
                                                },
                                                contentType: 'application/x-www-form-urlencoded'
                                            };
                                            NetStarUtils.ajax(deleteAjaxConfig,function(res){
                                                if(res.success){
                                                    NetStarGrid.delRow(data.rowData, data.gridId, data.rowIndex);
                                                }
                                            },true)
                                        }
                                    })
                                }
                            }
                        ];*/
                    }
                    var gridAjax = _grid.ajax;
                    if (typeof (gridAjax) == "object") {
                        nsVals.extendJSON(gridConfig.data, gridAjax);
                    }
                    if (_grid.id == 'mainlist-component-standard-1') {
                        gridConfig.ui.selectedHandler = function (rowData, $data, vueData, gridConfig) {
                            debugger;
                            // var treeJson = {};
                            // var treeArray = NetstarTemplate.tree.getSelectedNodes(
                            //     'tree-tree-component-standard-0');
                            // if (treeArray.length > 0) {
                            //     if (treeArray.length == 1) {
                            //         treeJson = treeArray[0];
                            //     }
                            // }
                            // NetStarGrid.refreshById('detaillist-component-standard-1', {
                            //     sampleCateId: treeJson.id,
                            //     testPricesId: rowData.id
                            // });
                        }
                    }
                    if (_grid.id == 'detaillist-component-standard-1') {
                        gridConfig.ui.isCheckSelect = true;
                        gridConfig.ui.selectMode = 'multi';
                        gridConfig.ui.selectedHandler = function (rowData, $data, vueData, gridConfig) {
                            NetStarGrid.refreshById('detaillist-component-standard-2', {
                                testPriceId: rowData.id
                            });
                        }
                    }
                    return gridConfig;
                }
                var mainListConfig = getGridConfig(mainConfig);
                var detailListConfig1 = getGridConfig(templateJson.components[2]);
                console.log(detailListConfig1);
                detailListConfig1.ui.tableRowBtns = [{
                    text: '删除',
                    handler: function (data) {
                        var rowData = data.rowData;
                        var ajaxConfig = {
                            url: getRootPath() + 'testPrices/delById',
                            type: 'POST',
                            data: {
                                id: rowData[detailListConfig1.data.idField]
                            },
                            contentType:'application/x-www-form-urlencoded',
                        }
                        NetStarUtils.ajax(ajaxConfig, function (res, _ajaxConfig) {
                            if (res.success) {
                                nsAlert('删除成功');
                            }
                        })
                    }
                }]
                var detailListConfig2 = getGridConfig(templateJson.components[3]);


                var treeGridConfig = {
                    displayMode: "treeGrid",
                    parentField: "parentId",
                    childField: 'children',
                    level: 1
                }
                NetStarUtils.setDefaultValues(detailListConfig1.ui, treeGridConfig);


                NetstarBlockList.init(mainListConfig);
                //NetStarGrid.init(mainListConfig);
                NetStarGrid.init(detailListConfig1);
                NetStarGrid.init(detailListConfig2);

                var navJson = {
                    id: 'mainlist-btn-component-standard-2',
                    isShowTitle: false,
                    btns: templateJson.components[4].field
                };
                vueButtonComponent.init(navJson);

                var navDetailJson = {
                    id: 'detaillist-btn-component-standard-5',
                    isShowTitle: false,
                    btns: templateJson.components[5].field
                };

                vueButtonComponent.init(navDetailJson);
            }
            init();
        })
    </script>
</container>